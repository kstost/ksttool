var ksttool={math:{}};ksttool.math.HALF_PI=Math.PI/2,ksttool.math.EPSILON=1e-7,ksttool.math.INFINITY=959e4,ksttool.math.TINYNANO=5.2e-13,ksttool.CIRCLE_COLLIDER=0,ksttool.RECTANGLE_COLLIDER=1,ksttool.POLYGON_COLLIDER=2,ksttool.LINE_TWOPOINT_COLLIDER=3,ksttool.TAG_GUIDE_LINE=10001,ksttool.ACTIVE_INSIDE_COLLISION=!0,ksttool.OPTION_LEVEL_FULL=0,ksttool.OPTION_LEVEL_LIGHT=1,ksttool.ALIGN_VERTICAL_TOP=0,ksttool.ALIGN_VERTICAL_MIDDLE=1,ksttool.ALIGN_VERTICAL_BOTTOM=2,ksttool.ALIGN_VERTICAL_MATCHTOP=6,ksttool.ALIGN_VERTICAL_MATCHBOTTOM=7,ksttool.ALIGN_HORIZONTAL_LEFT=3,ksttool.ALIGN_HORIZONTAL_CENTER=4,ksttool.ALIGN_HORIZONTAL_RIGHT=5,ksttool.ALIGN_HORIZONTAL_MATCHLEFT=8,ksttool.ALIGN_HORIZONTAL_MATCHRIGHT=9,ksttool.VECTOR_CHAIN_TYPE_NONE=0,ksttool.VECTOR_CHAIN_TYPE_PLP=1,ksttool.VECTOR_CHAIN_TYPE_XYX=2,ksttool.points_to_polypath=function(t){var e=0,o=[];return t.forEach(n=>{var i=t[e+1];void 0===i&&(i=t[0]),o.push({first:t[e],second:i}),e++}),o},ksttool.divide_square_into=function(t,e,o){for(var n=(2*t+2*e)/((o+=1)-1),i=[],_=0;_<o-1;_++)i.push((_+1)*n);var r=[0,t,t+e,t+e+t,t+e+t+e],l=[];for(_=0;_<r.length-1;_++)for(var s=0;s<i.length;s++){var c=i[s];if(r[_]<c&&r[_+1]>=c){var a=c-r[_],h=null;0==_&&(h={x:0+a,y:0}),1==_&&(h={x:t,y:0+a}),2==_&&(h={x:t+(a*=-1),y:e}),3==_&&(h={x:0,y:e+(a*=-1)}),l.push(h)}}return l},ksttool.math.get_distance_between_two_circle=function(t,e){return ksttool.math.get_distance_between_two_point(t.getPosition(),e.getPosition())-(ksttool.getNodeSize(t).as_circle.r+ksttool.getNodeSize(e).as_circle.r)},ksttool.math.get_destination_point_with_angle_and_distance=function(t,e,o,n){var i;n||(n=1),i=ksttool.math.get_distance_between_two_point(t,e)*n;var _=ksttool.math.convert_degrees_to_radian(ksttool.math.convert_radian_to_degrees(ksttool.math.get_angle_in_radian_between_two_points(t,e)));return{x:o.x+Math.cos(_)*i,y:o.y+Math.sin(_)*i}},ksttool.math.get_line_degree=function(t,e){var o=360-(180-Math.atan2(t.y-e.y,t.x-e.x)*(180/Math.PI));return 360==o&&(o=0),{degree:o,wdgr:o>180?o-180:o}},ksttool.math.calc_angle=function(t,e,o){var n=180-o-2*(90-ksttool.math.get_line_degree(t,e).wdgr);return n<0&&(n+=360),n},ksttool.math.conv_degree_for_human=function(t,e){return e?-180==(t-=180)&&(t=180):360==(t+=180)&&(t=0),t},ksttool.stick_flying_rect_node_on_border_rect_node=function(t,e){var o=ksttool.getNodeSize(t).as_rectangle,n=ksttool.getNodeSize(e).as_rectangle,i=ksttool.get_node_speed_and_direction_angle(t);if(i.last_coordinate_x=i.last_coordinate_x-o.w/2,i.last_coordinate_y=cc.winSize.height-(i.last_coordinate_y+o.h/2),!isNaN(i.last_coordinate_x)&&!isNaN(i.last_coordinate_y)&&null!=i.last_coordinate_x&&null!=i.last_coordinate_y){var _={x:i.last_coordinate_x,y:i.last_coordinate_y,w:o.w,h:o.h},r=ksttool.check_rectangle_position(_,n),l=null;1==r&&(l={x:n.x-(o.w/2+ksttool.math.EPSILON),y:cc.winSize.height-(n.y-o.h/2-ksttool.math.EPSILON)}),7==r&&(l={x:n.x-(o.w/2+ksttool.math.EPSILON),y:cc.winSize.height-(n.y+n.h+o.h/2+ksttool.math.EPSILON)}),4==r&&(l={x:n.x-(o.w/2+ksttool.math.EPSILON),y:cc.winSize.height-(o.y+o.h/2)}),6==r&&(l={x:n.x+n.w+(o.w/2+ksttool.math.EPSILON),y:cc.winSize.height-(o.y+o.h/2)}),8==r&&(l={x:o.x+o.w/2,y:cc.winSize.height-(n.y+n.h+o.h/2+ksttool.math.EPSILON)}),9==r&&(l={x:n.x+n.w+(o.w/2+ksttool.math.EPSILON),y:cc.winSize.height-(n.y+n.h+o.h/2+ksttool.math.EPSILON)}),2==r&&(l={x:o.x+o.w/2,y:cc.winSize.height-(n.y-o.h/2-ksttool.math.EPSILON)}),3==r&&(l={x:n.x+n.w+(o.w/2+ksttool.math.EPSILON),y:cc.winSize.height-(n.y-o.h/2-ksttool.math.EPSILON)}),l&&t.setPosition(l.x,l.y)}},ksttool.get_distance_between_two_rectangle=function(t,e){var o=null,n=ksttool.check_rectangle_position(t,e);return 1==n&&(o=ksttool.math.get_distance_between_two_point({x:t.x+t.w,y:t.y+t.h},{x:e.x,y:e.y})),2==n&&(o=e.y-(t.y+t.h)),3==n&&(o=ksttool.math.get_distance_between_two_point({x:t.x,y:t.y+t.h},{x:e.x+e.w,y:e.y})),4==n&&(o=e.x-(t.x+t.w)),5==n&&(o=0),6==n&&(o=t.x-(e.x+e.w)),7==n&&(o=ksttool.math.get_distance_between_two_point({x:t.x+t.w,y:t.y},{x:e.x,y:e.y+e.h})),8==n&&(o=t.y-(e.y+e.h)),9==n&&(o=ksttool.math.get_distance_between_two_point({x:t.x,y:t.y},{x:e.x+e.w,y:e.y+e.h})),o},ksttool.check_rectangle_position=function(t,e){return e.y>=t.y+t.h&&e.x>=t.x+t.w?1:e.y>=t.y+t.h&&e.x+e.w<=t.x?3:e.y+e.h<=t.y&&e.x+e.w<=t.x?9:e.y+e.h<=t.y&&e.x>=t.x+t.w?7:e.y>=t.y+t.h?2:e.y+e.h<=t.y?8:e.x>=t.x+t.w?4:e.x+e.w<=t.x?6:5},ksttool.math.set_sticked_point_on_direction_of_two_circle=function(t,e,o,n){for(var i=window.performance.now(),_=4*o.r,r=ksttool.math.get_coordinate_of_arc_between_center_of_the_circle_and_the_other_coordinate(_,t,e),l=t,s=!1,c=0,a=null;!s;){if((a=ksttool.math.get_coordinate_between_two_points(l,r,.5)).r=t.r,ksttool.check_if_two_circle_are_overlapped_with_their_center_coordinate_and_radius(o,a))l=a;else r=a,ksttool.math.get_distance_between_two_point(a,o)-(o.r+a.r)<.05&&(s=!0);++c>1e3&&(s=!0)}if(!n){var h=a.r;(a=ksttool.math.get_coordinate_of_arc_between_center_of_the_circle_and_the_other_coordinate(o.r+a.r+ksttool.math.EPSILON,o,a)).r=h}return a.counter=c,a.execute_time=window.performance.now()-i,a},ksttool.math.get_coordinate_distance_away_from_center_with_degree=function(t,e,o){var n=ksttool.math.convert_degrees_to_radian(o);return{x:e.x+Math.cos(n)*t,y:e.y+Math.sin(n)*t}},ksttool.force_positive=function(t){return t<0?-t:t},ksttool.math.get_coordinate_of_arc_between_center_of_the_circle_and_the_other_coordinate=function(t,e,o){var n=ksttool.math.get_angle_in_radian_between_two_points(o,e);return{x:e.x+Math.cos(n)*t,y:e.y+Math.sin(n)*t}},ksttool.math.get_angle_in_radian_between_two_points=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},ksttool.math.get_distance_between_two_point=function(t,e){var o=t.x-e.x,n=t.y-e.y;return Math.sqrt(o*o+n*n)},ksttool.math.get_coordinate_between_two_points=function(t,e,o){var n=ksttool.math.get_distance_between_two_point(t,e);return ksttool.math.get_coordinate_of_arc_between_center_of_the_circle_and_the_other_coordinate(n*o,t,e)},ksttool.math.convert_radian_to_degrees=function(t){return t*(180/Math.PI)},ksttool.math.convert_degrees_to_radian=function(t){return t*(Math.PI/180)},ksttool.math.rotation_coordinate=function(t,e,o,n){n||(o=360-o);var i=ksttool.math.convert_degrees_to_radian(o),_=Math.cos(i),r=Math.sin(i);return{x:_*(e.x-t.x)+r*(e.y-t.y)+t.x,y:_*(e.y-t.y)-r*(e.x-t.x)+t.y}},ksttool.math.generate_random_value=function(t,e){var o=arguments.length;if(0===o)t=0,e=2147483647;else if(1===o)throw new Error("Warning: rand() expects exactly 2 parameters, 1 given");return Math.floor(Math.random()*(e-t+1))+t},ksttool.rand=function(t,e){return ksttool.math.generate_random_value(t,e)},ksttool.get_node_speed_and_direction_angle=function(t){var e={};return null==t.move_speed||isNaN(t.move_speed)?e.move_speed=0:e.move_speed=t.move_speed,null==t.last_moved_angle||isNaN(t.last_moved_angle)||(e.last_moved_angle=t.last_moved_angle),null==t.last_coordinate_x||isNaN(t.last_coordinate_x)||(e.last_coordinate_x=t.last_coordinate_x),null==t.last_coordinate_y||isNaN(t.last_coordinate_y)||(e.last_coordinate_y=t.last_coordinate_y),e},ksttool.update_node_move_information=function(t,e){e||(e=t.getPosition()),t.before_coordinate_x==e.x&&t.before_coordinate_y==e.y||(t.last_moved_angle=ksttool.math.get_angle_in_radian_between_two_points({x:t.before_coordinate_x,y:t.before_coordinate_y},{x:e.x,y:e.y}),t.last_coordinate_x=t.before_coordinate_x,t.last_coordinate_y=t.before_coordinate_y),t.move_speed=ksttool.math.get_distance_between_two_point({x:t.before_coordinate_x,y:t.before_coordinate_y},e),t.before_coordinate_x=e.x,t.before_coordinate_y=e.y},ksttool.set_seperate_stick_two_circle=function(t,e,o){var n=ksttool.getNodeSize(t).as_circle,i=ksttool.getNodeSize(e).as_circle,_=ksttool.get_node_speed_and_direction_angle(t),r=ksttool.get_node_speed_and_direction_angle(e),l=null;o?(_.move_speed>r.move_speed||0==_.move_speed&&0==r.move_speed)&&(l=ksttool.math.get_coordinate_of_arc_between_center_of_the_circle_and_the_other_coordinate(i.r+n.r+ksttool.math.EPSILON,i,n)):null!=t.stick_ticket&&(delete t.stick_ticket,delete e.stick_ticket,null!=l||null==t.last_moved_angle||isNaN(t.last_moved_angle)||(l=ksttool.math.set_sticked_point_on_direction_of_two_circle(n,{x:n.x+Math.cos(-1*t.last_moved_angle)*n.r,y:n.y+Math.sin(-1*t.last_moved_angle)*n.r,r:n.r},i))),l&&t.setPosition(l.x,cc.winSize.height-l.y)},ksttool.getPosition=function(t){var e=t.getPosition();return e.y=cc.winSize.height-e.y,e},ksttool.setPositionTo=function(t,e){t.setPosition(e.x,cc.winSize.height-e.y)},ksttool.getAdvPosition=function(t){var e=ksttool.getNodeSize(t).as_rectangle,o=ksttool.getPosition(t);return o.x-=e.w/2,o.y-=e.h/2,o.w=e.w,o.h=e.h,o},ksttool.setPositionAdvTo=function(t,e,o){if("object"==typeof e)if(e.hasOwnProperty("x")&&e.hasOwnProperty("y")){var n=ksttool.getNodeSize(t).as_rectangle;t.setPosition(e.x+n.w/2,t.getParent().height-e.y+-n.h/2)}else if(e.hasOwnProperty("v")||e.hasOwnProperty("h")){n=ksttool.getAdvPosition(t);var i=null;null!=o&&null!=o&&(i=ksttool.getAdvPosition(o));var _=0,r=0;e.hasOwnProperty("v")&&(e.v==ksttool.ALIGN_VERTICAL_MATCHTOP&&(r=i.y),e.v==ksttool.ALIGN_VERTICAL_MATCHBOTTOM&&(r=i.y-(n.h-i.h)),e.v==ksttool.ALIGN_VERTICAL_TOP&&(r=null==i?0:i.y-n.h),e.v==ksttool.ALIGN_VERTICAL_MIDDLE&&(r=null==i?(t.getParent().height-n.h)/2:i.y-(n.h-i.h)/2),e.v==ksttool.ALIGN_VERTICAL_BOTTOM&&(r=null==i?t.getParent().height-n.h:i.y+i.h)),e.hasOwnProperty("h")&&(e.h==ksttool.ALIGN_HORIZONTAL_MATCHLEFT&&(_=i.x),e.h==ksttool.ALIGN_HORIZONTAL_MATCHRIGHT&&(_=i.x-(n.w-i.w)),e.h==ksttool.ALIGN_HORIZONTAL_LEFT&&(_=null==i?0:i.x-n.w),e.h==ksttool.ALIGN_HORIZONTAL_CENTER&&(_=null==i?(t.getParent().width-n.w)/2:i.x-(n.w-i.w)/2),e.h==ksttool.ALIGN_HORIZONTAL_RIGHT&&(_=null==i?t.getParent().width-n.w:i.x+i.w)),e.hasOwnProperty("vmargin")&&(r+=e.vmargin),e.hasOwnProperty("hmargin")&&(_+=e.hmargin),ksttool.setPositionAdvTo(t,{x:_,y:r},o)}},ksttool.setPositionBy=function(t,e){var o=null;if(e.x&&e.y&&(o=t.getPosition()),e.x){var n=null;null!=o&&(n=o.x),null==n&&(n=t.getPositionX()),t.setPositionX(n+e.x)}if(e.y){var i=null;null!=o&&(i=o.y),null==i&&(i=t.getPositionY()),t.setPositionY(i+-1*e.y)}},ksttool.draw_guide_line_for_polygon_collider=function(t,e,o){for(;o&&t.getChildByTag(ksttool.TAG_GUIDE_LINE);)t.removeChildByTag(ksttool.TAG_GUIDE_LINE);var n=e;if(n.collider_type==ksttool.RECTANGLE_COLLIDER||n.collider_type==ksttool.POLYGON_COLLIDER)for(var i=ksttool.get_polygon_line_path(n),_=0;_<i.length;_++){var r=new cc.DrawNode,l={x:i[_].first.x,y:cc.winSize.height-i[_].first.y},s={x:i[_].second.x,y:cc.winSize.height-i[_].second.y};r.drawSegment(l,s,1),r.setTag(ksttool.TAG_GUIDE_LINE),t.addChild(r)}if(n.collider_type==ksttool.CIRCLE_COLLIDER){var c=ksttool.getNodeSize(n).as_circle;(r=new cc.DrawNode).drawCircle(cc.p(c.x,cc.winSize.height-c.y),c.r,0,15,!0,2),r.setTag(ksttool.TAG_GUIDE_LINE),t.addChild(r)}},ksttool.get_min_max_value_of_polygon_list=function(t){var e={x:null,y:null},o={x:null,y:null};for(var n in t){var i="",_="";_="first",null==e[i="x"]?e[i]=t[n][_][i]:e[i]>t[n][_][i]&&(e[i]=t[n][_][i]),_="second",null==e[i]?e[i]=t[n][_][i]:e[i]>t[n][_][i]&&(e[i]=t[n][_][i]),_="first",null==e[i="y"]?e[i]=t[n][_][i]:e[i]>t[n][_][i]&&(e[i]=t[n][_][i]),_="second",null==e[i]?e[i]=t[n][_][i]:e[i]>t[n][_][i]&&(e[i]=t[n][_][i]),_="first",null==o[i="x"]?o[i]=t[n][_][i]:o[i]<t[n][_][i]&&(o[i]=t[n][_][i]),_="second",null==o[i]?o[i]=t[n][_][i]:o[i]<t[n][_][i]&&(o[i]=t[n][_][i]),_="first",null==o[i="y"]?o[i]=t[n][_][i]:o[i]<t[n][_][i]&&(o[i]=t[n][_][i]),_="second",null==o[i]?o[i]=t[n][_][i]:o[i]<t[n][_][i]&&(o[i]=t[n][_][i])}return{max:o,min:e}},ksttool.get_parent_node_list=function(t){for(var e=[],o=t.getParent();null!=o;)e.push(o),o=o.getParent();return e},ksttool.checkPointIsInsideCircle=function(t,e){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<=t.r*t.r},ksttool.checkPointIsInsidePolygon=function(t,e){for(var o=t,n=!1,i=-1,_=o.length,r=_-1;++i<_;r=i)(o[i].first.y<=e.y&&e.y<o[r].first.y||o[r].first.y<=e.y&&e.y<o[i].first.y)&&e.x<(o[r].first.x-o[i].first.x)*(e.y-o[i].first.y)/(o[r].first.y-o[i].first.y)+o[i].first.x&&(n=!n);return n},ksttool.checkPointIsInsideRectangle=function(t,e){var o=function(t,e,o){return t<o&&e>t&&e<o||(t>o&&e>o&&e<t||(e==t||e==o))};return o(t.x,e.x,t.x+t.w)&&o(t.y,e.y,t.y+t.h)},ksttool.isPointIsInsideNode=function(t,e,o,n){if(t.collider_type==ksttool.CIRCLE_COLLIDER)return n||(n=ksttool.getNodeSize(t).as_circle),ksttool.checkPointIsInsideCircle(n,e);if(t.collider_type==ksttool.RECTANGLE_COLLIDER&&t.option_level==ksttool.OPTION_LEVEL_LIGHT){var i=ksttool.getNodeSize(t).as_rectangle;return ksttool.checkPointIsInsideRectangle(i,e)}return t.collider_type==ksttool.RECTANGLE_COLLIDER||t.collider_type==ksttool.POLYGON_COLLIDER?(o||(o=ksttool.get_polygon_line_path(t)),ksttool.checkPointIsInsidePolygon(o,e)):void 0},ksttool.calc_center=function(t){return{x:t.x+t.w/2,y:t.y+t.h/2}},ksttool.check_intersection_advanced_line_circle=function(t,e){},ksttool.math.get_point_on_arc=function(t,e){let o=!0;for(var n=ksttool.math.get_angle_in_radian_between_two_points(t,e),i=t.r;o;){var _=ksttool.math.get_coordinate_distance_away_from_center_with_radian(i,t,n);if(ksttool.math.get_distance_between_two_point(t,_)>=t.r)return o=!1,_;i+=ksttool.math.EPSILON}},ksttool.check_intersection_line_circle=function(t,e){let o,n,i=Math.sqrt,_=null,r=t.second.x-t.first.x,l=t.second.y-t.first.y,s=i(r*r+l*l),c=r/s,a=l/s,h=c*(e.x-t.first.x)+a*(e.y-t.first.y),d=h*c+t.first.x,f=h*a+t.first.y,g=i((d-e.x)*(d-e.x)+(f-e.y)*(f-e.y)),k=function(t,e){let o=t.r,n=Math.atan2(t.y-e.y,t.x-e.x)+Math.PI;for(;;){e.x=t.x+Math.cos(n)*o,e.y=t.y+Math.sin(n)*o;let _=t.x-e.x,r=t.y-e.y;if(i(_*_+r*r)>=t.r)return e;o+=1e-7}};for(let s=0;s<3;s++){s>1&&(s=-1);{let _=t.first.x-e.x,r=t.first.y-e.y,l=t.second.x-e.x,c=t.second.y-e.y,a=1e-7*s;o=i(_*_+r*r)+a,n=i(l*l+c*c)+a}let y=o>=e.r,u=n>=e.r,x=y&&n<e.r||u&&o<e.r;if(g<e.r){let o=i(e.r*e.r-g*g)-1e-7,n=h-o,s=h+o,d=c*r+a*l,f=n<0||n>d,p=s<0||s>d;!x&&f&&p?_=[]:x&&f?_=[k(e,{x:s*c+t.first.x,y:s*a+t.first.y})]:x&&p&&(_=[k(e,{x:n*c+t.first.x,y:n*a+t.first.y})]),!_&&y&&u&&(_=[k(e,{x:n*c+t.first.x,y:n*a+t.first.y}),k(e,{x:s*c+t.first.x,y:s*a+t.first.y})])}else if(g==e.r){let o={x:d,y:f},n={x:d,y:f},i=ksttool.math.get_angle_in_radian_between_two_points(e,o),r=ksttool.math.get_coordinate_distance_away_from_center_with_radian(ksttool.math.get_distance_between_two_point(e,o)+1e-7,e,i);ksttool.check_intersection_line_line({first:e,second:r},t,!0)&&(_=[o=k(e,o),n=k(e,n)])}if(_||x||(_=[]),null!==_||-1==s)return _}return[]},ksttool.check_intersection_legacy_line_circle=function(t,e){let o,n,i,_,r,l,s,c,a,h;if(h={},(a={}).x=t.second.x-t.first.x,a.y=t.second.y-t.first.y,h.x=t.first.x-e.x,h.y=t.first.y-e.y,o=a.x*h.x+a.y*h.y,n=2*(a.x*a.x+a.y*a.y),o*=-2,i=Math.sqrt(o*o-2*n*(h.x*h.x+h.y*h.y-e.r*e.r)),isNaN(i)){var d=null,f=null,g=t.second.x-t.first.x,k=t.second.y-t.first.y,y=Math.sqrt(g*g+k*k),u=g/y,x=k/y,p=u*(e.x-t.first.x)+x*(e.y-t.first.y),w=p*u+t.first.x,m=p*x+t.first.y,I=Math.sqrt((w-e.x)*(w-e.x)+(m-e.y)*(m-e.y));if(I<e.r){var L=Math.sqrt(e.r*e.r-I*I),v=u*(t.second.x-t.first.x)+x*(t.second.y-t.first.y);return(p-L<0||p-L>v)&&(p+L<0||p+L>v)?[]:p-L<0||p-L>v?((d={}).x=(p+L)*u+t.first.x,d.y=(p+L)*x+t.first.y,[d]):p+L<0||p+L>v?((d={}).x=(p-L)*u+t.first.x,d.y=(p-L)*x+t.first.y,[d]):(f={},(d={}).x=(p-L)*u+t.first.x,d.y=(p-L)*x+t.first.y,f.x=(p+L)*u+t.first.x,f.y=(p+L)*x+t.first.y,[d,f])}if(I==e.r){f={},(d={}).x=w,d.y=m,f.x=w,f.y=m;var E=ksttool.math.get_angle_in_radian_between_two_points(e,d),b=ksttool.math.get_coordinate_distance_away_from_center_with_radian(ksttool.math.get_distance_between_two_point(e,d)+ksttool.math.EPSILON,e,E);if(ksttool.check_intersection_line_line({first:e,second:b},t,!0))return[d,f]}return[]}_=(o-i)/n,r=(o+i)/n,s={},c={};let P=[0,-ksttool.math.EPSILON,ksttool.math.EPSILON];l=[];var N=P.length;let O=null;for(O=0;O<N;O++)if(_+P[O]<=1&&_+P[O]>=0){s.x=t.first.x+a.x*(_+P[O]),s.y=t.first.y+a.y*(_+P[O]),l[0]=s;break}for(O=0;O<N;O++)if(r+P[O]<=1&&r+P[O]>=0){c.x=t.first.x+a.x*(r+P[O]),c.y=t.first.y+a.y*(r+P[O]),l[l.length]=c;break}return l},ksttool.check_intersection_rect_rect=function(t,e){return!(e.left>t.right||e.right<t.left||e.top<t.bottom||e.bottom>t.top)},ksttool.check_intersection_two_line=function(t,e,o,n,i,_,r,l,s){var c,a,h,d;return 0!=(c=(l-_)*(o-t)-(r-i)*(n-e))&&(d=(o-t)*(a=e-_)-(n-e)*(h=t-i),a=((r-i)*a-(l-_)*h)/c,h=d/c,s?{x:t+a*(o-t),y:e+a*(n-e),onLine1:a>0&&a<1,onLine2:h>0&&h<1}:a>0&&a<1&&h>0&&h<1&&{x:t+a*(o-t),y:e+a*(n-e)})},ksttool.check_intersection_line_line=function(t,e,o){if(o)return ksttool.check_intersection_two_line(t.first.x,t.first.y,t.second.x,t.second.y,e.first.x,e.first.y,e.second.x,e.second.y,!1);{let o=t,g=e;var n=o.first.x,i=o.first.y,_=o.second.x,r=o.second.y,l=g.first.x,s=g.first.y,c=g.second.x,a=g.second.y,h=function(t,e,o){return t-ksttool.math.EPSILON<=e&&e<=o+ksttool.math.EPSILON},d=((n*r-i*_)*(l-c)-(n-_)*(l*a-s*c))/((n-_)*(s-a)-(i-r)*(l-c)),f=((n*r-i*_)*(s-a)-(i-r)*(l*a-s*c))/((n-_)*(s-a)-(i-r)*(l-c));if(isNaN(d)||isNaN(f))return!1;if(n>=_){if(!h(_,d,n))return!1}else if(!h(n,d,_))return!1;if(i>=r){if(!h(r,f,i))return!1}else if(!h(i,f,r))return!1;if(l>=c){if(!h(c,d,l))return!1}else if(!h(l,d,c))return!1;if(s>=a){if(!h(a,f,s))return!1}else if(!h(s,f,a))return!1;return{x:d,y:f}}},ksttool.getNodeSize=function(t,e){var o=t.option_level;if(o||(o=ksttool.OPTION_LEVEL_FULL),e||(e=t.getPosition()),o!=ksttool.OPTION_LEVEL_LIGHT){if(o==ksttool.OPTION_LEVEL_FULL){var n=e,i=t.getParent().convertToWorldSpace(n),_=(m=t.getContentSize(),t.getScaleX()),r=t.getScaleY(),l={};l.rotationX=t.getRotationX(),l.rotationY=t.getRotationY(),l.scaleX=_,l.scaleY=r,_=(l=ksttool.accumulate_reflection(t,l)).scaleX,r=l.scaleY;var s=m.width*_,c=m.height*r,a=i.x-s/2,h=i.y-c/2,d={x:a,y:cc.winSize.height-h-c,w:s,h:c,contentSizeW:m.width,contentSizeH:m.height,scaleX:_,scaleY:r,rotationX:l.rotationX,rotationY:l.rotationY};if(t.collider_type!=ksttool.CIRCLE_COLLIDER)return{as_rectangle:d};x=0,p=0;return(g=d.w/2)<(k=d.h/2)?x=k-g:p=g-k,{as_circle:{x:d.x+g-p,y:d.y+k-x,r:w=g>k?k:g,scaleX:d.scaleX,scaleY:d.scaleY,rotationX:d.rotationX,rotationY:d.rotationY}}}return console.log("구현되지 않은 옵션입니다"),null}if(t.collider_type==ksttool.CIRCLE_COLLIDER){var f=e;(m=t.getContentSize()).width*=t.getScaleX(),m.height*=t.getScaleY();var g,k,y=f.x-m.width/2,u=cc.winSize.height-(f.y-m.height/2)-m.height,x=0,p=0,w=0;return(g=m.width/2)>(k=m.height/2)?(w=k,p=g-k):(w=g,x=k-g),{as_circle:{x:y+g-p,y:u+k-x,r:w}}}if(t.collider_type==ksttool.RECTANGLE_COLLIDER){var m;f=e;return(m=t.getContentSize()).width*=t.getScaleX(),m.height*=t.getScaleY(),{as_rectangle:{x:f.x-m.width/2,y:cc.winSize.height-(f.y+m.height/2),w:m.width,h:m.height}}}console.log("LIGHT option does not support polygon")},ksttool.get_polygon_line_path=function(t){var e=ksttool.getNodeSize(t).as_rectangle,o=null;if(t.collider_type==ksttool.POLYGON_COLLIDER){if(t.hasOwnProperty("collide_polygon"))o=t.collide_polygon.path;else if(t.get_custom_box_attr("polygon_path")){var n=$cc.ccoo(cocosKst.const.sizeRatio.height),i=0-n+2*t.parent.getPosition().y,_=-t.parent.getPosition().y+n,r=t.get_custom_box_attr("polygon_path"),l=[];r.forEach(e=>{l.push({first:{x:e.first.x-t.parent.getPosition().x,y:i-(e.first.y-_)},second:{x:e.second.x-t.parent.getPosition().x,y:i-(e.second.y-_)}})}),o=l}}else if(t.collider_type==ksttool.RECTANGLE_COLLIDER){if(t.option_level==ksttool.OPTION_LEVEL_LIGHT)return[{first:{x:e.x,y:e.y},second:{x:e.x,y:e.y+e.h}},{first:{x:e.x,y:e.y+e.h},second:{x:e.x+e.w,y:e.y+e.h}},{first:{x:e.x+e.w,y:e.y+e.h},second:{x:e.x+e.w,y:e.y}},{first:{x:e.x+e.w,y:e.y},second:{x:e.x,y:e.y}}];o=[{first:{x:0,y:0},second:{x:0,y:e.contentSizeH}},{first:{x:0,y:e.contentSizeH},second:{x:e.contentSizeW,y:e.contentSizeH}},{first:{x:e.contentSizeW,y:e.contentSizeH},second:{x:e.contentSizeW,y:0}},{first:{x:e.contentSizeW,y:0},second:{x:0,y:0}}]}return o=ksttool.calculate_duplicate_plp(o,e)},ksttool.accumulate_reflection=function(t,e){e||(e=t.collider_type==ksttool.CIRCLE_COLLIDER?ksttool.getNodeSize(t).as_circle:ksttool.getNodeSize(t).as_rectangle);var o={};o.rotationX=e.rotationX,o.rotationY=e.rotationY,o.scaleX=e.scaleX,o.scaleY=e.scaleY;for(var n=ksttool.get_parent_node_list(t),i=0;i<n.length;i++)null!=n[i]&&n[i]instanceof cc.Node&&(o.rotationX+=n[i].getRotationX(),o.rotationY+=n[i].getRotationY(),o.scaleX*=n[i].getScaleX(),o.scaleY*=n[i].getScaleY());return o},ksttool.calculate_duplicate_plp=function(t,e){for(var o=[],n=0;n<t.length;n++){var i={first:{x:t[n].first.x*e.scaleX+e.x+0,y:t[n].first.y*e.scaleY+e.y+0},second:{x:t[n].second.x*e.scaleX+e.x+0,y:t[n].second.y*e.scaleY+e.y+0}};if(0!=e.rotationX&&360!=e.rotationX){var _=ksttool.calc_center(e);i.first=ksttool.math.rotation_coordinate(_,i.first,e.rotationX,!1),i.second=ksttool.math.rotation_coordinate(_,i.second,e.rotationX,!1)}o.push(i)}return o},ksttool.check_collision_rectangle_circle=function(t,e){var o=ksttool.getNodeSize(t).as_rectangle,n=ksttool.getNodeSize(e).as_circle,i=o.w/2,_=o.h/2,r={x:n.x-(o.x+i),y:n.y-(o.y+_)},l=Math.abs(r.x)-i,s=Math.abs(r.y)-_;return!(l>n.r||s>n.r)&&(!(l<-n.r&&s<-n.r)&&(l<0||s<0||l*l+s*s<n.r*n.r))},ksttool.get_circle_info=function(t,e){var o=ksttool.getNodeSize(t).as_circle;return e?(o.x=e.x,o.y=e.y):(o.x=t.getPositionX(),o.y=t.getPositionY()),o.r2=2*o.r,o},ksttool.get_point_on_the_line=function(t,e){var o=null;return o=e.hasOwnProperty("angle")?e.angle:ksttool.math.get_angle_in_radian_between_two_points(e.to,e.from),{x:e.from.x+Math.cos(o)*t,y:e.from.y+Math.sin(o)*t}},ksttool.check_collision_circle_circle=function(t,e){var o=ksttool.getNodeSize(t).as_circle,n=ksttool.getNodeSize(e).as_circle;return ksttool.check_if_two_circle_are_overlapped_with_their_center_coordinate_and_radius(o,n)},ksttool.check_if_two_circle_are_overlapped_with_their_center_coordinate_and_radius=function(t,e){var o=t.x-e.x,n=t.y-e.y;return t.r+e.r>Math.sqrt(o*o+n*n)},ksttool.check_collision_polygon_circle=function(t,e){if(t.collider_type==ksttool.RECTANGLE_COLLIDER&&t.option_level==ksttool.OPTION_LEVEL_LIGHT&&e.option_level==ksttool.OPTION_LEVEL_LIGHT)return ksttool.check_collision_rectangle_circle(t,e);for(var o=!1,n=ksttool.get_polygon_line_path(t),i=ksttool.getNodeSize(e).as_circle,_=0;_<n.length&&!o;_++)o=0!=ksttool.check_intersection_line_circle(n[_],i).length;if(ksttool.ACTIVE_INSIDE_COLLISION&&!o&&!(o=ksttool.isPointIsInsideNode(t,{x:i.x,y:i.y},n))&&t.collider_type==ksttool.POLYGON_COLLIDER){var r=n;for(_=0;!o&&_<r.length;_++)o=ksttool.checkPointIsInsideCircle(i,r[_].first)}return o},ksttool.check_collision_polygon_polygon=function(t,e){if(t.option_level==ksttool.OPTION_LEVEL_LIGHT&&e.option_level==ksttool.OPTION_LEVEL_LIGHT&&t.collider_type==ksttool.RECTANGLE_COLLIDER&&e.collider_type==ksttool.RECTANGLE_COLLIDER){var o=ksttool.getNodeSize(t).as_rectangle,n=ksttool.getNodeSize(e).as_rectangle;return!(n.x>o.x+o.w||n.x+n.w<o.x||n.y>o.y+o.h||n.y+n.h<o.y)}for(var i=!1,_=ksttool.get_polygon_line_path(t),r=ksttool.get_polygon_line_path(e),l=0;l<_.length&&!i;l++)for(var s=0;s<r.length&&!i;s++)i=ksttool.check_intersection_line_line(_[l],r[s]);if(ksttool.ACTIVE_INSIDE_COLLISION){if(!i)for(l=0;l<_.length&&!i;l++)i=ksttool.isPointIsInsideNode(e,_[l].first,r);if(!i)for(l=0;l<r.length&&!i;l++)i=ksttool.isPointIsInsideNode(t,r[l].first,_)}return i},ksttool.change_rect_type1_to_type2=function(t){return ksttool.make_rect_cover_things([t],!1,2)},ksttool.change_rect_type2_to_type1=function(t){var e=[{first:{x:t.left,y:t.bottom}},{first:{x:t.left,y:t.top}},{first:{x:t.right,y:t.top}},{first:{x:t.right,y:t.bottom}}];return e[0].second=e[1].first,e[1].second=e[2].first,e[2].second=e[3].first,e[3].second=e[0].first,e},ksttool.make_rect_cover_things=function(t,e,o){var n=null,i=null,_=null,r=null;t.forEach(t=>{void 0!==t.r?(e&&$cc.gen_simple_dot(t,2*t.r,cc.color(255,155,55,255)),t=[{first:{x:t.x-t.r,y:t.y-t.r}},{first:{x:t.x-t.r,y:t.y+t.r}},{first:{x:t.x+t.r,y:t.y+t.r}},{first:{x:t.x+t.r,y:t.y-t.r}}]):e&&t.forEach(t=>{$cc.gen_simple_line(t).setAdvColor(cc.color(255,255,255,255))}),t.forEach(t=>{null===n&&(n=t.first.x),n>t.first.x&&(n=t.first.x),null===i&&(i=t.first.x),i<t.first.x&&(i=t.first.x),null===_&&(_=t.first.y),_>t.first.y&&(_=t.first.y),null===r&&(r=t.first.y),r<t.first.y&&(r=t.first.y)})});var l=null;return 1===o?((l=[{first:{x:n,y:_}},{first:{x:n,y:r}},{first:{x:i,y:r}},{first:{x:i,y:_}}])[0].second=l[1].first,l[1].second=l[2].first,l[2].second=l[3].first,l[3].second=l[0].first):l={left:n,top:r,right:i,bottom:_},l},ksttool.check_collision=function(t,e){var o=!1;return o||t.collider_type!=ksttool.CIRCLE_COLLIDER||e.collider_type!=ksttool.CIRCLE_COLLIDER||(1,o=ksttool.check_collision_circle_circle(e,t)),o||t.collider_type!=ksttool.CIRCLE_COLLIDER||e.collider_type!=ksttool.RECTANGLE_COLLIDER||(2,o=ksttool.check_collision_polygon_circle(e,t)),o||t.collider_type!=ksttool.CIRCLE_COLLIDER||e.collider_type!=ksttool.POLYGON_COLLIDER||(3,o=ksttool.check_collision_polygon_circle(e,t)),o||t.collider_type!=ksttool.RECTANGLE_COLLIDER||e.collider_type!=ksttool.CIRCLE_COLLIDER||(4,o=ksttool.check_collision_polygon_circle(t,e)),o||t.collider_type!=ksttool.RECTANGLE_COLLIDER||e.collider_type!=ksttool.RECTANGLE_COLLIDER||(5,o=ksttool.check_collision_polygon_polygon(t,e)),o||t.collider_type!=ksttool.RECTANGLE_COLLIDER||e.collider_type!=ksttool.POLYGON_COLLIDER||(6,o=ksttool.check_collision_polygon_polygon(e,t)),o||t.collider_type!=ksttool.POLYGON_COLLIDER||e.collider_type!=ksttool.CIRCLE_COLLIDER||(7,o=ksttool.check_collision_polygon_circle(t,e)),o||t.collider_type!=ksttool.POLYGON_COLLIDER||e.collider_type!=ksttool.RECTANGLE_COLLIDER||(8,o=ksttool.check_collision_polygon_polygon(e,t)),o||t.collider_type!=ksttool.POLYGON_COLLIDER||e.collider_type!=ksttool.POLYGON_COLLIDER||(9,o=ksttool.check_collision_polygon_polygon(e,t)),o},ksttool.math.get_coordinate_of_circle_stick_circle=function(t){var e={r:t.collide_circle.r+t.moving_circle.r,x:t.collide_circle.x,y:t.collide_circle.y},o={x:t.position_before.x,y:t.position_before.y},n={x:t.position_current.x,y:t.position_current.y},i=ksttool.math.get_angle_in_radian_between_two_points(o,n),_=ksttool.math.get_angle_in_radian_between_two_points(n,o),r={first:o,second:ksttool.math.get_coordinate_distance_away_from_center_with_radian(ksttool.math.INFINITY,o,i)},l=ksttool.check_intersection_line_circle(r,e),s={};l.length<2&&(l=ksttool.check_intersection_line_circle({first:o,second:ksttool.math.get_coordinate_distance_away_from_center_with_radian(ksttool.math.INFINITY,o,_)},e));var c=[];for(var a in l)l[a]&&c.push({coordinate:l[a]});if((c=ksttool.math.sort_list_by_distance(c,o)).length>0){l=c[0].coordinate,(l=ksttool.math.get_coordinate_distance_away_from_center_with_radian(e.r,e,ksttool.math.get_angle_in_radian_between_two_points(e,l))).r=t.moving_circle.r;for(;ksttool.check_if_two_circle_are_overlapped_with_their_center_coordinate_and_radius(t.collide_circle,l);)(l=ksttool.math.get_coordinate_distance_away_from_center_with_radian(ksttool.math.EPSILON,l,_)).r=t.moving_circle.r,0}s={place_to_be:null,next_angle:null,error:""};return l&&(s.place_to_be=l,s.next_angle=ksttool.math.calculate_next_angle_of_moving_circle_collided_with_other_circle(l,e,r.first,r.second)),s},ksttool.is_two_points_same=function(t,e){return!(!t||!e)&&(t.x===e.x&&t.y===e.y)},ksttool.math.check_collision_plp_circle=function(t,e){for(var o=!1,n=0;!o&&n<t.length;n++)ksttool.check_intersection_line_circle(t[n],e).length>0&&(o=!0);return o||(o=ksttool.checkPointIsInsidePolygon(t,e)),o},ksttool.math.calculate_next_angle_of_moving_circle_collided_with_other_circle=function(t,e,o,n){var i=ksttool.math.get_angle_in_radian_between_two_points(t,e)+Math.PI/2;return ksttool.math.calculate_next_angle_of_moving_circle_collided_with_other_line({first:ksttool.math.get_coordinate_distance_away_from_center_with_radian(1,e,i),second:e},o,n)},ksttool.math.calculate_next_angle_of_moving_circle_collided_with_other_line=function(t,e,o){return ksttool.math.calc_angle(t.first,t.second,ksttool.math.conv_degree_for_human(ksttool.math.convert_radian_to_degrees(ksttool.math.get_angle_in_radian_between_two_points(e,o))))},ksttool.math.make_square_coordinate_with_circle_direction=function(t){var e=ksttool.math.get_distance_between_two_point(t.position_before,t.position_current),o=[],n=ksttool.math.get_coordinate_distance_away_from_center_with_radian(t.circle_info.r/2*2,t.position_before,ksttool.math.get_angle_in_radian_between_two_points(t.position_before,t.position_current)+Math.PI/2);o.push(n);var i=ksttool.math.get_coordinate_distance_away_from_center_with_radian(e,n,ksttool.math.get_angle_in_radian_between_two_points(t.position_before,t.position_current));o.push(i);var _=ksttool.math.get_coordinate_distance_away_from_center_with_radian(2*t.circle_info.r,i,ksttool.math.get_angle_in_radian_between_two_points(t.position_before,t.position_current)+-Math.PI/2);o.push(_);var r=ksttool.math.get_coordinate_distance_away_from_center_with_radian(t.circle_info.r/2*2,t.position_before,ksttool.math.get_angle_in_radian_between_two_points(t.position_before,t.position_current)+-Math.PI/2);return o.push(r),o=ksttool.points_to_polypath(o)},ksttool.math.get_coordinate_distance_away_from_center_with_radian=function(t,e,o){return o+=Math.PI,{x:e.x+Math.cos(o)*t,y:e.y+Math.sin(o)*t}},ksttool.check_is_point_on_rect=function(t,e){return(t.y==e.top||t.y==e.bottom)&&e.left<=t.x&&e.right>=t.x||(t.x==e.left||t.x==e.right)&&e.bottom<=t.y&&e.top>=t.y},ksttool.check_line_is_stick_through_rect=function(t,e){let o=t.first,n=t.second;for(let t=0;t<2;t++){if(o.y==e.top&&n.y==e.top&&o.x<e.left&&n.x>=e.left)return!0;if(o.y==e.bottom&&n.y==e.bottom&&o.x<e.left&&n.x>=e.left)return!0;if(o.y==e.top&&n.y==e.top&&o.x>e.right&&n.x<=e.right)return!0;if(o.y==e.bottom&&n.y==e.bottom&&o.x>e.right&&n.x<=e.right)return!0;if(o.x==e.left&&n.x==e.left&&o.y>e.top&&n.y<=e.top)return!0;if(o.x==e.right&&n.x==e.right&&o.y>e.top&&n.y<=e.top)return!0;if(o.x==e.left&&n.x==e.left&&o.y<e.bottom&&n.y>=e.bottom)return!0;if(o.x==e.right&&n.x==e.right&&o.y<e.bottom&&n.y>=e.bottom)return!0;let t=n;n=o,o=t}return!1},ksttool.check_intersection_line_rect=function(t,e){if(!(e.left>t.first.x||e.right<t.first.x||e.top<t.first.y||e.bottom>t.first.y)||!(e.left>t.second.x||e.right<t.second.x||e.top<t.second.y||e.bottom>t.second.y))return!0;if(ksttool.check_is_point_on_rect(t.first,e)||ksttool.check_is_point_on_rect(t.second,e))return!0;let o=ksttool.change_rect_type2_to_type1(e);for(let e=0,n=o.length;e<n;e++)if(ksttool.check_intersection_line_line(o[e],t,!0))return!0;return!!ksttool.check_line_is_stick_through_rect(t,e)},ksttool.math.get_coordinate_of_circle_stick_line=function(t){var e=t.circle_radius,o={x:t.position_before.x,y:t.position_before.y},n={x:t.position_current.x,y:t.position_current.y},i=ksttool.math.INFINITY,_=ksttool.math.get_angle_in_radian_between_two_points(o,n),r=ksttool.math.get_coordinate_distance_away_from_center_with_radian(i,o,_),l=ksttool.math.get_coordinate_distance_away_from_center_with_radian(-i,o,_),s={name:"cdl",first:o,second:r},c={first:l,second:r},a={name:"l",first:{x:t.collide_line.first.x,y:t.collide_line.first.y},second:{x:t.collide_line.second.x,y:t.collide_line.second.y}},h=a.first,d=a.second,f=ksttool.math.get_distance_between_two_point(h,d),g=ksttool.math.get_angle_in_radian_between_two_points(h,d),k=ksttool.math.get_coordinate_distance_away_from_center_with_radian(e,h,g+Math.PI/2),y={name:"ll",first:k,second:ksttool.math.get_coordinate_distance_away_from_center_with_radian(f,k,g)},u=ksttool.math.get_coordinate_distance_away_from_center_with_radian(e,h,g+-Math.PI/2),x={name:"lr",first:u,second:ksttool.math.get_coordinate_distance_away_from_center_with_radian(f,u,g)},p=[a,y,x];let w;for(var m=[],I=0;I<p.length;I++){let t;!(t=ksttool.check_intersection_line_line(c,p[I],!0))&&w&&(t=ksttool.check_intersection_line_line({name:"cdl",first:ksttool.math.get_coordinate_distance_away_from_center_with_radian(ksttool.math.EPSILON,o,-ksttool.math.get_angle_in_radian_between_two_points(o,n)),second:r},p[I],!0)),m.push({coordinate:t,body:p[I]})}var L=null,v=0,E=null;if(0==(m=ksttool.math.sort_list_by_distance(m,o)).length||m.length>0&&"l"==m[0].body.name||1==m.length&&"l"!=m[0].body.name){h.r=e,d.r=e;var b=[];if([h,d].forEach(t=>{ksttool.check_intersection_line_circle(s,t).forEach(e=>{b.push({coordinate:e,circle:t})})}),(b=ksttool.math.sort_list_by_distance(b,o)).length>0&&(L=b[0].coordinate),L){L.r=e;var P=ksttool.check_intersection_line_circle(a,L);m.length>0&&"l"!=m[0].body.name&&2==P.length&&(v=1,(L=m[0].coordinate).r=e)}}else m.length>=2&&"l"==m[1].body.name&&(L=m[0].coordinate,v=1);let N=0;if(L){var O=L;O.r=e;var C=ksttool.math.EPSILON,T=null;T=void 0!==t.virtual_height&&void 0!==t.real_height?t.real_height/t.virtual_height:$cc.ccph(1)/cocosKst.const.sizeRatio.height,v||(C*=1e3);let n=!1;for(;ksttool.check_intersection_line_circle(a,O).length>0;){if(N>10){n=!0;break}N++,(O=ksttool.math.get_coordinate_distance_away_from_center_with_radian(C,O,ksttool.math.get_angle_in_radian_between_two_points(r,o))).r=e,(C*=5)>T&&(C=T)}if(n){var R=ksttool.math.get_distance_between_two_point(t.position_before,t.position_current),S=100*T;(R>S||R<=0)&&(R=S),C=R;for(var A=n,M=n;A!==M&&(A=M,C/=2),(O=ksttool.math.get_coordinate_distance_away_from_center_with_radian(C*(M?1:-1),O,ksttool.math.get_angle_in_radian_between_two_points(r,o))).r=e,N++,M=ksttool.check_intersection_line_circle(a,O).length>0,!(T>=C)||M;);}if((L=O).line_width=2*e,L.r=e,delete L.line_width,1==v)E=ksttool.math.calculate_next_angle_of_moving_circle_collided_with_other_line(a,t.position_before,t.position_current);else{var G=ksttool.math.get_distance_between_two_point(L,a.first)<ksttool.math.get_distance_between_two_point(L,a.second)?a.first:a.second;E=ksttool.math.calculate_next_angle_of_moving_circle_collided_with_other_circle(L,G,o,r)}}return{rp_point:L,cdl_line:s,center_line:a,line_left:y,line_right:x,next_angle:E}},ksttool.math.sort_list_by_distance=function(t,e){for(var o=[],n=[],i=0;i<t.length;i++){var _=null,r=null,l=-1;for(var s in t){var c=t[s].coordinate;if(c){var a=ksttool.math.get_distance_between_two_point(e,c);(null==r||null!==_&&_>a)&&(n.includes(s)||(r=t[s],_=a,l=s))}}r&&(n.push(l),o.push(r))}return o},ksttool.get_aite_angle_direction=function(t,e,o){o&&(e=ksttool.math.convert_degrees_to_radian(e),t=ksttool.math.convert_degrees_to_radian(t));var n=ksttool.calc_difference_between_two_radian(e,t);let i=t+n,_=t-n;i>Math.PI&&(i-=2*Math.PI),_>Math.PI&&(_-=2*Math.PI),i<=-Math.PI&&(i+=2*Math.PI),_<=-Math.PI&&(_+=2*Math.PI);let r=ksttool.get_distance_between_two_number(e,i),l=ksttool.get_distance_between_two_number(e,_);return r>=2*Math.PI&&(r-=2*Math.PI),l>=2*Math.PI&&(l-=2*Math.PI),r<l},ksttool.get_distance_between_two_number=function(t,e){return t>e?t-e:e-t},ksttool.calc_mid_radian_between_two_line=function(t,e,o){var n=ksttool.math.get_angle_in_radian_between_two_points(t.first,t.second),i=ksttool.math.get_angle_in_radian_between_two_points(e.second,e.first);return void 0===o&&(o=.5),ksttool.calc_difference_between_two_radian(n,i)*o},ksttool.is_vv_in_radian=function(t,e,o){return void 0===o&&(o=Math.PI/2),ksttool.calc_difference_between_two_radian(t,e)<o},ksttool.calc_difference_between_two_radian=function(t,e){var o=t-e;return o<0&&(o*=-1),o>Math.PI?2*Math.PI-o:o},ksttool.make_vector_with_two_point_and_a_vector=function(t,e,o){var n=ksttool.math.get_angle_in_radian_between_two_points(t,e),i=n-Math.PI,_=ksttool.math.get_angle_in_radian_between_two_points(o.first,o.second),r=!1;return ksttool.is_vv_in_radian(n,_)&&(r=!0),ksttool.is_vv_in_radian(i,_)&&(r=!0,[t,e]=[e,t]),r?{first:t,second:e}:null},ksttool.make_collision_area=function(t,e){let o=null,n=ksttool.check_intersection_line_line(t,e,!0);if(n)o=[{direction:ksttool.math.get_angle_in_radian_between_two_points(t.first,e.first),plp:[{first:n,second:t.first},{first:t.first,second:e.first},{first:e.first,second:n}],future:{first:e.first,second:n}},{direction:ksttool.math.get_angle_in_radian_between_two_points(t.second,e.second),plp:[{first:n,second:t.second},{first:t.second,second:e.second},{first:e.second,second:n}],future:{first:e.second,second:n}}];else{let n={first:t.first,second:e.first},i={first:t.second,second:e.second};o=[{direction:ksttool.calc_angle_average_of_two_lines(n,i),plp:[{first:t.first,second:t.second},{first:t.second,second:e.second},{first:e.second,second:e.first},{first:e.first,second:t.first}],future:e}]}return o},ksttool.check_area_and_ballnode=function(t,e,o){let n=t,i=!1,_=e.future;if((i=!!o||ksttool.check_intersection_line_circle(e.plp[2],n).length>0)||ksttool.checkPointIsInsidePolygon(e.plp,n)&&(i=!0),i){let t={circle_radius:n.r,position_before:ksttool.math.get_coordinate_distance_away_from_center_with_radian(1e6,n,e.direction),position_current:n,collide_line:_};if(o){let o=[];if(e.plp.forEach(e=>{t.collide_line=e;var n=ksttool.math.get_coordinate_of_circle_stick_line(t);n.rp_point&&(o[o.length]={coordinate:n.rp_point})}),o.length>0){return ksttool.math.sort_list_by_distance(o,t.position_before)[0].coordinate}return null}var r=ksttool.math.get_coordinate_of_circle_stick_line(t);if(r.rp_point)return r.rp_point}},ksttool.calc_angle_average_of_two_lines=function(t,e){var o=ksttool.math.get_angle_in_radian_between_two_points(t.first,t.second),n=ksttool.math.get_angle_in_radian_between_two_points(e.first,e.second),i=ksttool.calc_difference_between_two_radian(o,n),_=ksttool.math.get_distance_between_two_point(t.first,t.second),r=ksttool.math.get_distance_between_two_point(e.first,e.second),l=0;l=_>r?r/(_+r):_/(_+r);let s=0;if(_<r){s=ksttool.get_aite_angle_direction(n,o)?n+l*i:n-l*i}else{ksttool.get_aite_angle_direction(o,n);s=ksttool.get_aite_angle_direction(o,n)?o+l*i:o-l*i}return s>Math.PI&&(s-=2*Math.PI),s},ksttool.checkRayCastedCollided=function(t,e){for(var o=!1,n=e.length,i=0;!o&&i<n;i++){var _=null,r=e[i]instanceof cc.Node,l=e[i];if(r){if(!o){var s=l.getCircleInfo();ksttool.check_if_two_circle_are_overlapped_with_their_center_coordinate_and_radius(s,t)&&(o=!0)}}else if(_=l,!o)o=ksttool.check_intersection_line_circle(_,t).length>0}return o},ksttool.bouncing_path_of_ball=function(t,e,o,n,i,_,r,l){let s=[];for(s[s.length]={body:null,coordinate:n,next_angle_info:o};;){let c=ksttool.calculate_coordinate(n,o,t,i,_,r,l);if(c.body&&o!==c.next_angle_info&&(s[s.length]=c),n=c.coordinate,o=c.next_angle_info,s.length>e)break}return s},ksttool.check_line_collided=function(t,e,o){let n=!1;for(let o=0,i=e.length;o<i;o++)if(ksttool.check_intersection_line_line(e[o],t,!0)){n=!0;break}return n||(n=ksttool.check_intersection_line_circle(t,o).length>0),n},ksttool.calculate_coordinate=function(t,e,o,n,i,_,r){var l={circle_info:{r:t.r},position_before:t,position_current:ksttool.math.get_coordinate_distance_away_from_center_with_degree(o,t,e)},s=ksttool.math.make_square_coordinate_with_circle_direction(l),c={x:l.position_current.x,y:l.position_current.y,r:l.circle_info.r},a={x:l.position_before.x,y:l.position_before.y,r:l.circle_info.r},h={body:null,coordinate:c,next_angle_info:e},d=null;if(n){let t=n.get_section(ksttool.make_rect_cover_things([c,s],!1,2));for(let e=0,o=t.length;e<o;e++)t[e].line.forEach(t=>{let e=!1;for(let o=0,n=s.length;o<n;o++)if(ksttool.check_intersection_line_line(s[o],t,!0)){e=!0;break}e||(e=ksttool.check_intersection_line_circle(t,c).length>0),e&&(null===d&&(d=[]),d[d.length]=t)})}if(i.length>0&&i.loop(function(t){if(void 0!==t.body){if(!_&&t.body instanceof PixiPolygon){if(t.body.is_vector()){let e=t.body.get_vector();ksttool.check_line_collided(e,s,c)&&(null===d&&(d=[]),e.extd=t.body,d[d.length]=e)}else{let e=t.body.getWorldPathInPLPType(),o=e.length;for(let n=0;n<o;n++){let o=e[n];ksttool.check_line_collided(o,s,c)&&(null===d&&(d=[]),o.extd=t.body,d[d.length]=o)}}}if(_&&t.body instanceof AdvPolygon){if(t.body.is_vector()){let e=t.body.get_vector();ksttool.check_line_collided(e,s,c)&&(null===d&&(d=[]),e.extd=t.body,d[d.length]=e)}else{let e=t.body.getWorldPathInPLPType(),o=e.length;for(let n=0;n<o;n++){let o=e[n];ksttool.check_line_collided(o,s,c)&&(null===d&&(d=[]),o.extd=t.body,d[d.length]=o)}}}if(_&&t.body instanceof PolyNode){let e=t.body.getNode().get_custom_box_attr("polyline");e&&t.body.translatePLInWorld(e).forEach(t=>{let e=!1;for(let o=0,n=s.length;o<n;o++)if(ksttool.check_intersection_line_line(s[o],t,!0)){e=!0;break}e||(e=ksttool.check_intersection_line_circle(t,c).length>0),e&&(null===d&&(d=[]),d[d.length]=t)})}}}),d&&d.length>0){var f=[];if(d.forEach(t=>{var e=null,o=null,n=null;if(_&&t instanceof cc.Node){var i={collide_circle:t.getCircleInfo(),moving_circle:{r:c.r},position_before:a,position_current:c},l=ksttool.math.get_coordinate_of_circle_stick_circle(i);l.place_to_be&&(ksttool.checkRayCastedCollided(l.place_to_be,d)||(e=l.place_to_be,o=l.next_angle,n=t))}else{i={circle_radius:c.r,position_before:a,position_current:c,collide_line:t};r&&(i.real_height=r.r,i.virtual_height=r.v);var s=ksttool.math.get_coordinate_of_circle_stick_line(i);e=s.rp_point,o=s.next_angle,n=t}null!==e&&f.push({coordinate:e,body:n,next_angle_info:o})}),(f=ksttool.math.sort_list_by_distance(f,a)).length>0){h.body=f[0].body,h.coordinate=f[0].coordinate,h.next_angle_info=f[0].next_angle_info,ksttool.math.get_distance_between_two_point(c,a)<ksttool.math.get_distance_between_two_point(c,h.coordinate)&&(h.coordinate=a,h.next_angle_info=f[0].next_angle_info)}}return h},ksttool.check_intersection_rect_line=function(t,e){let o=ksttool.checkPointIsInsidePolygon(t,e.second)||ksttool.checkPointIsInsidePolygon(t,e.first);if(!o)for(let n=0,i=t.length;n<i;n++)if(ksttool.check_intersection_line_line(t[n],e,!0)){o=!0;break}return o},ksttool.convert_XYX_to_PLP=function(t,e){var o=[];for(let n=0,i=t.length-1;n<i;n++){let i=e?{x:t[n].x,y:t[n].y}:t[n],_=e?{x:t[n+1].x,y:t[n+1].y}:t[n+1];o[o.length]={first:i,second:_}}return o.length>0&&(o[o.length]={first:o[o.length-1].second,second:o[0].first}),o},ksttool.check_type_of_vector_chain=function(t){return t.length?t[0].first?ksttool.VECTOR_CHAIN_TYPE_PLP:ksttool.VECTOR_CHAIN_TYPE_XYX:ksttool.VECTOR_CHAIN_TYPE_NONE},ksttool.reset_length_of_vector_from_mid=function(t,e){let o={},n=ksttool.math.get_angle_in_radian_between_two_points(e.second,e.first),i=ksttool.math.get_coordinate_between_two_points(e.second,e.first,.5);return o.first=ksttool.math.get_coordinate_distance_away_from_center_with_radian(-t,i,n),o.second=ksttool.math.get_coordinate_distance_away_from_center_with_radian(t,i,n),o},ksttool.convert_PLP_to_XYX=function(t,e,o){let n=[];for(let o=0,i=t.length;o<i;o++){let _=o===i-1;e?(n[n.length]={x:t[o].first.x,y:t[o].first.y},_&&(n[n.length]={x:t[o].second.x,y:t[o].second.y})):(n[n.length]=t[o].first,_&&(n[n.length]=t[o].second))}return o&&n.splice(n.length-1,1),n},ksttool.divide_polygon=function(t,e){{let o=ksttool.convert_XYX_to_PLP(t),n=e.length,i=0,_=0;for(let t=0;t<n;t++){let r=ksttool.checkPointIsInsidePolygon(o,e[t]);t===n-1||0===t?r||i++:r&&_++}let r=2;if(i<r)return null;if(_<n-r){let i=!1,_=[],r=[];for(let t=0;t<n-1;t++){let n={first:e[t],second:e[t+1]},l=!1;for(let t=0;t<o.length;t++)if(ksttool.check_intersection_line_line(o[t],n,!0)){l=!0;break}if(i?_[_.length]=n:l&&(_[_.length]=n,i=!0),l){let t=i;(i=ksttool.checkPointIsInsidePolygon(o,n.second))||t==i||(r[r.length]=_,_=[])}}let l=[],s=[t];for(let t=0;t<r.length;t++){let e=[];for(let o=0;o<r[t].length;o++)e[e.length]=r[t][o].first,o===r[t].length-1&&(e[e.length]=r[t][o].second);l[l.length]=e}for(let t=0;t<l.length;t++){let e=l[t],o=[];for(;s.length;){let t=s.splice(0,1)[0],n=ksttool.divide_polygon(t,e);if(n)for(let t=0;t<n.length;t++)o[o.length]=n[t]}s=o}return s}}{let o={first:e[0],second:e[1]},n={first:e[e.length-2],second:e[e.length-1]};if(e.length>=3){let e=[];[o,n].forEach(o=>{for(let n=0;n<t.length;n++){let i={a:o,b:{first:t[n],second:t[n!==t.length-1?n+1:0]}},_=ksttool.check_intersection_line_line(i.a,i.b,!0);_&&e.push({idx:n,coo:_,lnd:i.b})}}),e[0].idx===e[1].idx&&(t=JSON.parse(JSON.stringify(t))).splice(e[0].idx+1,0,ksttool.math.get_coordinate_between_two_points(e[0].coo,e[1].coo,.5))}}let o=[];for(let n=0;n<2;n++){let i=[];o.push(i);let _=0===n?ksttool.convert_XYX_to_PLP(e):ksttool.convert_XYX_to_PLP(e.reverse());_.splice(_.length-1,1);let r=[],l=null,s=0,c=-1;for(let e=0;e<t.length;e++){let o=t[e],n=t[e!==t.length-1?e+1:0],a=null,h=-1;for(let t=0;t<_.length;t++){let e={a:_[t],b:{first:o,second:n}};if(!a&&(a=ksttool.check_intersection_line_line(e.a,e.b,!0))){h=t;break}}if(a){if(s++,l||(l=[]),l&&(l[l.length]=a,s<2&&(c=h,l[l.length]=n)),s>=2){i[i.length]=l;for(let t=c-1;t>=h;t--)l[l.length]=_[c-(t+1)].second,r[r.length]=_[t].second;r[r.length]=a,r[r.length]=n,s=0,l=null}1===s&&(0===r.length&&(r[r.length]=o),r[r.length]=a)}else l?l[l.length]=n:(0===r.length&&(r[r.length]=o),r[r.length]=n)}i[i.length]=r;for(let t=0;t<i.length;t++)i[t][i[t].length-1].x===i[t][0].x&&i[t][i[t].length-1].y===i[t][0].y&&i[t].splice(i[t].length-1,1)}let n=-1,i=null;for(let t=0;t<o.length;t++){let e=0;for(let n=0;n<o[t].length;n++)e+=o[t][n].length;0===t?n=e:i=n<e?o[o.length-1]:o[0]}return i},ksttool.extract_XYX=function(t,e){let o,n,i,_,r=[];e=e||{x:0,y:0};for(let e=0,r=t.length;e<r;e++)void 0!==o&&void 0!==i||(o=t[e].x,i=t[e].x),void 0!==n&&void 0!==_||(n=t[e].y,_=t[e].y),o>t[e].x&&(o=t[e].x),n>t[e].y&&(n=t[e].y),i<t[e].x&&(i=t[e].x),_<t[e].y&&(_=t[e].y);let l=i-o,s=_-n;for(let i=0;i<t.length;i++){let _=l*e.x,c=s*e.y;r[r.length]={x:t[i].x-(o+_),y:t[i].y-(n+c)}}return{path:r,width:l,height:s,pivot:e,min_x:o+e.x*l,min_y:n+e.y*s}},ksttool.md5sum=function(t){function e(t,e){return t<<e|t>>>32-e}function o(t,e){var o,n,i,_,r;return i=2147483648&t,_=2147483648&e,r=(1073741823&t)+(1073741823&e),(o=1073741824&t)&(n=1073741824&e)?2147483648^r^i^_:o|n?1073741824&r?3221225472^r^i^_:1073741824^r^i^_:r^i^_}function n(t,n,i,_,r,l,s){return o(e(t=o(t,o(o(function(t,e,o){return t&e|~t&o}(n,i,_),r),s)),l),n)}function i(t,n,i,_,r,l,s){return o(e(t=o(t,o(o(function(t,e,o){return t&o|e&~o}(n,i,_),r),s)),l),n)}function _(t,n,i,_,r,l,s){return o(e(t=o(t,o(o(function(t,e,o){return t^e^o}(n,i,_),r),s)),l),n)}function r(t,n,i,_,r,l,s){return o(e(t=o(t,o(o(function(t,e,o){return e^(t|~o)}(n,i,_),r),s)),l),n)}function l(t){var e,o="",n="";for(e=0;e<=3;e++)o+=(n="0"+(t>>>8*e&255).toString(16)).substr(n.length-2,2);return o}var s,c,a,h,d,f,g,k,y,u=Array();for(u=function(t){for(var e,o=t.length,n=o+8,i=16*((n-n%64)/64+1),_=Array(i-1),r=0,l=0;l<o;)r=l%4*8,_[e=(l-l%4)/4]=_[e]|t.charCodeAt(l)<<r,l++;return r=l%4*8,_[e=(l-l%4)/4]=_[e]|128<<r,_[i-2]=o<<3,_[i-1]=o>>>29,_}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}(t)),f=1732584193,g=4023233417,k=2562383102,y=271733878,s=0;s<u.length;s+=16)c=f,a=g,h=k,d=y,g=r(g=r(g=r(g=r(g=_(g=_(g=_(g=_(g=i(g=i(g=i(g=i(g=n(g=n(g=n(g=n(g,k=n(k,y=n(y,f=n(f,g,k,y,u[s+0],7,3614090360),g,k,u[s+1],12,3905402710),f,g,u[s+2],17,606105819),y,f,u[s+3],22,3250441966),k=n(k,y=n(y,f=n(f,g,k,y,u[s+4],7,4118548399),g,k,u[s+5],12,1200080426),f,g,u[s+6],17,2821735955),y,f,u[s+7],22,4249261313),k=n(k,y=n(y,f=n(f,g,k,y,u[s+8],7,1770035416),g,k,u[s+9],12,2336552879),f,g,u[s+10],17,4294925233),y,f,u[s+11],22,2304563134),k=n(k,y=n(y,f=n(f,g,k,y,u[s+12],7,1804603682),g,k,u[s+13],12,4254626195),f,g,u[s+14],17,2792965006),y,f,u[s+15],22,1236535329),k=i(k,y=i(y,f=i(f,g,k,y,u[s+1],5,4129170786),g,k,u[s+6],9,3225465664),f,g,u[s+11],14,643717713),y,f,u[s+0],20,3921069994),k=i(k,y=i(y,f=i(f,g,k,y,u[s+5],5,3593408605),g,k,u[s+10],9,38016083),f,g,u[s+15],14,3634488961),y,f,u[s+4],20,3889429448),k=i(k,y=i(y,f=i(f,g,k,y,u[s+9],5,568446438),g,k,u[s+14],9,3275163606),f,g,u[s+3],14,4107603335),y,f,u[s+8],20,1163531501),k=i(k,y=i(y,f=i(f,g,k,y,u[s+13],5,2850285829),g,k,u[s+2],9,4243563512),f,g,u[s+7],14,1735328473),y,f,u[s+12],20,2368359562),k=_(k,y=_(y,f=_(f,g,k,y,u[s+5],4,4294588738),g,k,u[s+8],11,2272392833),f,g,u[s+11],16,1839030562),y,f,u[s+14],23,4259657740),k=_(k,y=_(y,f=_(f,g,k,y,u[s+1],4,2763975236),g,k,u[s+4],11,1272893353),f,g,u[s+7],16,4139469664),y,f,u[s+10],23,3200236656),k=_(k,y=_(y,f=_(f,g,k,y,u[s+13],4,681279174),g,k,u[s+0],11,3936430074),f,g,u[s+3],16,3572445317),y,f,u[s+6],23,76029189),k=_(k,y=_(y,f=_(f,g,k,y,u[s+9],4,3654602809),g,k,u[s+12],11,3873151461),f,g,u[s+15],16,530742520),y,f,u[s+2],23,3299628645),k=r(k,y=r(y,f=r(f,g,k,y,u[s+0],6,4096336452),g,k,u[s+7],10,1126891415),f,g,u[s+14],15,2878612391),y,f,u[s+5],21,4237533241),k=r(k,y=r(y,f=r(f,g,k,y,u[s+12],6,1700485571),g,k,u[s+3],10,2399980690),f,g,u[s+10],15,4293915773),y,f,u[s+1],21,2240044497),k=r(k,y=r(y,f=r(f,g,k,y,u[s+8],6,1873313359),g,k,u[s+15],10,4264355552),f,g,u[s+6],15,2734768916),y,f,u[s+13],21,1309151649),k=r(k,y=r(y,f=r(f,g,k,y,u[s+4],6,4149444226),g,k,u[s+11],10,3174756917),f,g,u[s+2],15,718787259),y,f,u[s+9],21,3951481745),f=o(f,c),g=o(g,a),k=o(k,h),y=o(y,d);return(l(f)+l(g)+l(k)+l(y)).toLowerCase()},ksttool.find_center_point_of_polygon=function(t){let e,o,n,i,_,r=t||[],l=t.length,s=0,c=0,a=0;for(e=0,o=l-1;e<l;o=e,e+=1)i=r[e],_=r[o],n=i.x*_.y-_.x*i.y,c+=(i.x+_.x)*n,a+=(i.y+_.y)*n;for(e=0,o=l-1;e<l;o=e,e+=1)i=r[e],_=r[o],s+=i.x*_.y,s-=i.y*_.x;return{x:c/(n=6*(s/=2)),y:a/n}},ksttool.is_included_in_list=function(t,e){for(let o=0,n=t.length;o<n;o++)if(t[o]===e)return!0;return!1},ksttool.polyInter=function(t,e){for(let o=0,n=t.length;o<n;o++)for(let n=0,i=e.length;n<i;n++)if(ksttool.check_intersection_line_line(t[o],e[n],!0))return!0};
